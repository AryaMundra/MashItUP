<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MashItUP- Mashup Creator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>MashItUP</h1>
            <p>Create Automated Music Mashups</p>
            <div class="subtitle">Transform your favorite songs into amazing mashups with our intelligent audio processing</div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <ul>
                <li><a href="{{ url_for('index') }}" class="active">Home</a></li>
                <li><a href="{{ url_for('search') }}">Create Mashup</a></li>
                <li><a href="{{ url_for('results') }}">My Mashups</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Welcome Back Section (if user has previous data) -->
            <section class="card" id="welcomeBackSection" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">Welcome Back!</h2>
                    <div class="card-subtitle">You have previous mashup data</div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <p style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">
                        We found <span id="previousMashupCount">0</span> mashup(s) from your previous session.
                    </p>
                    
                    <div class="btn-group">
                        <button id="continuePreviousBtn" class="btn success">
                            üìÇ Continue Previous Session
                        </button>
                        <button id="startFreshBtn" class="btn warning">
                            üÜï Start Fresh
                        </button>
                    </div>
                </div>
            </section>

            <!-- Hero Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">Welcome to MashItUP</h2>
                    <div class="card-subtitle">The future of music creation is here</div>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <p style="font-size: 1.1rem; margin-bottom: 25px; color: rgba(255, 255, 255, 0.9);">
                        Create stunning mashups by combining your favorite songs 
                    </p>
                    
                    <div class="btn-group">
                        <a href="{{ url_for('search') }}" class="btn primary btn-large">
                            üé§ Start Creating
                        </a>
                        <a href="{{ url_for('results') }}" class="btn secondary btn-large">
                            üìÅ View My Mashups
                        </a>
                    </div>
                </div>
            </section>

            <!-- Session Status -->
            <section class="card" id="sessionStatusSection" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">Session Status</h3>
                </div>
                
                <div class="session-stats">
                    <div class="stat-item">
                        <span class="stat-label">User ID:</span>
                        <span id="userIdDisplay" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Active Sessions:</span>
                        <span id="activeSessionsDisplay" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Mashups:</span>
                        <span id="totalMashupsDisplay" class="stat-value">0</span>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">Features</h2>
                    <div class="card-subtitle">Everything you need to create amazing mashups</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="feature-card">
                        <div class="feature-icon">üéµ</div>
                        <h3>AI-Powered Mixing</h3>
                        <p>Our intelligent algorithms automatically detect beats, keys, and optimal mixing points for seamless mashups.</p>
                    </div>
                    

                    
                    <div class="feature-card">
                        <div class="feature-icon">‚ö°</div>
                        <h3>Real-Time Processing</h3>
                        <p>Experience lightning-fast mashup creation with our optimized audio processing pipeline.</p>
                    </div>
                    

                    <div class="feature-card">
                        <div class="feature-icon">üé®</div>
                        <h3>Smart Transitions</h3>
                        <p>Automatic crossfades, beat matching, and harmonic mixing for professional-sounding results.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">üì±</div>
                        <h3>Easy to Use</h3>
                        <p>Intuitive interface designed for both beginners and professionals. No audio engineering experience required.</p>
                    </div>
                </div>
            </section>

            <!-- How It Works Section -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">How It Works</h2>
                    <div class="card-subtitle">Create your mashup in 4 simple steps</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-top: 30px;">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3>Search Songs</h3>
                        <p>Find your favorite tracks using our integrated Spotify search. Select 2 or more songs to create your mashup.</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3>AI Processing</h3>
                        <p>Our AI analyzes your songs for tempo, key, and structure to create the perfect blend automatically in your private session.</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3>Download & Create</h3>
                        <p>Songs are downloaded to your isolated workspace and processed using advanced audio algorithms.</p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h3>Export & Enjoy</h3>
                        <p>Download your finished mashup in high quality. Your session data is automatically managed for privacy.</p>
                    </div>
                </div>
            </section>

            <!-- Call to Action -->
            <section class="card" style="text-align: center;">
                <h2 style="color: #4ecdc4; margin-bottom: 15px;">Ready to Create Your First Mashup?</h2>
                <p style="font-size: 1.1rem; margin-bottom: 25px; color: rgba(255, 255, 255, 0.9);">
                    Join thousands of creators and start making amazing music today!
                </p>
                
                <div class="btn-group">
                    <a href="{{ url_for('search') }}" class="btn primary btn-large">
                        üöÄ Get Started Now
                    </a>
                    <button id="clearDataBtn" class="btn secondary" style="display: none;">
                        üóëÔ∏è Clear All Data
                    </button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024 MashupMaker. All rights reserved.</p>
            <div class="footer-links">
                <a href="#about">About</a>
                <a href="#privacy">Privacy</a>
                <a href="#terms">Terms</a>
                <a href="#contact">Contact</a>
            </div>
        </footer>
    </div>

    <script>
        // Session management for index page
        document.addEventListener('DOMContentLoaded', function() {
            initializeIndexPage();
        });

        function initializeIndexPage() {
            // Check for existing user data
            checkExistingUserData();
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Load session status
            loadSessionStatus();
            
            console.log('Index page initialized with session management');
        }

        function checkExistingUserData() {
            // Check localStorage for previous mashups
            const userId = localStorage.getItem('user_id');
            if (userId) {
                const userMashups = getUserMashups();
                
                if (userMashups.length > 0) {
                    // Show welcome back section
                    document.getElementById('welcomeBackSection').style.display = 'block';
                    document.getElementById('previousMashupCount').textContent = userMashups.length;
                    document.getElementById('clearDataBtn').style.display = 'inline-block';
                }
                
                // Show session status
                document.getElementById('sessionStatusSection').style.display = 'block';
                document.getElementById('userIdDisplay').textContent = userId.substring(0, 8) + '...';
                document.getElementById('totalMashupsDisplay').textContent = userMashups.length;
            }
        }

        function getUserMashups() {
            const userId = localStorage.getItem('user_id');
            if (!userId) return [];
            
            const stored = localStorage.getItem('mashup_user_data_' + userId);
            return stored ? JSON.parse(stored) : [];
        }

        function initializeEventListeners() {
            // Continue previous session
            document.getElementById('continuePreviousBtn')?.addEventListener('click', function() {
                window.location.href = '/results';
            });

            // Start fresh
            document.getElementById('startFreshBtn')?.addEventListener('click', function() {
                if (confirm('This will clear all your previous mashups. Are you sure?')) {
                    clearAllUserData();
                    location.reload();
                }
            });

            // Clear all data
            document.getElementById('clearDataBtn')?.addEventListener('click', function() {
                if (confirm('This will permanently delete all your mashups and data. Are you sure?')) {
                    clearAllUserData();
                    location.reload();
                }
            });
        }

        function clearAllUserData() {
            const userId = localStorage.getItem('user_id');
            if (userId) {
                localStorage.removeItem('mashup_user_data_' + userId);
                sessionStorage.clear();
            }
            
            // Also clear any session data
            fetch('/api/cleanup-session', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({clear_all: true})
            }).catch(console.error);
            
            console.log('All user data cleared');
        }

        async function loadSessionStatus() {
            try {
                const response = await fetch('/api/session-status');
                const data = await response.json();
                
                if (data.total_sessions !== undefined) {
                    document.getElementById('activeSessionsDisplay').textContent = data.total_sessions;
                }
            } catch (error) {
                console.error('Failed to load session status:', error);
            }
        }

        // Handle page visibility for cleanup
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Page is hidden - user might be leaving
                console.log('Page hidden - potential cleanup trigger');
            }
        });

        // Simple animations
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 200);
        });
    </script>
</body>
</html>
